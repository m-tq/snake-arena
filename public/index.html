<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake Arena ‚Äî Realtime Multiplayer</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { mono: ['"Fira Code"', 'monospace'] },
          colors: {
            primary: 'hsl(var(--primary) / <alpha-value>)',
            'primary-fg': 'hsl(var(--primary-foreground) / <alpha-value>)',
            accent: 'hsl(var(--accent) / <alpha-value>)',
            'accent-fg': 'hsl(var(--accent-foreground) / <alpha-value>)',
            muted: 'hsl(var(--muted) / <alpha-value>)',
            'muted-fg': 'hsl(var(--muted-foreground) / <alpha-value>)',
            destructive: 'hsl(var(--destructive) / <alpha-value>)',
            card: 'hsl(var(--card) / <alpha-value>)',
            'card-fg': 'hsl(var(--card-foreground) / <alpha-value>)',
            border: 'hsl(var(--border) / <alpha-value>)',
            input: 'hsl(var(--input) / <alpha-value>)',
            ring: 'hsl(var(--ring) / <alpha-value>)',
            bg: 'hsl(var(--background) / <alpha-value>)',
            fg: 'hsl(var(--foreground) / <alpha-value>)',
            teal: '#00E5C0',
          },
          borderRadius: { none: '0', full: '9999px' },
          boxShadow: {
            card: '0 2px 12px 0 rgba(0,0,0,.12)',
            'card-dark': '0 2px 16px 0 rgba(0,0,0,.45)',
            glow: '0 0 8px 2px currentColor',
            'glow-lg': '0 0 14px 4px currentColor',
          },
          animation: {
            'fade-in': 'fadeIn .3s ease-out forwards',
            'fade-out': 'fadeOut .25s ease-in forwards',
            'slide-up': 'slideUp .35s ease-out forwards',
            'slide-down': 'slideDown .3s ease-out forwards',
            'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
            'countdown-pop': 'countdownPop .5s cubic-bezier(.2,1.4,.5,1) forwards',
            'snake-slither': 'snakeSlither 1.5s ease-in-out infinite',
            'spin-slow': 'spin 3s linear infinite',
          },
          keyframes: {
            fadeIn:       { from: { opacity: '0' }, to: { opacity: '1' } },
            fadeOut:      { from: { opacity: '1' }, to: { opacity: '0' } },
            slideUp:      { from: { opacity: '0', transform: 'translateY(20px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
            slideDown:    { from: { opacity: '0', transform: 'translateY(-20px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
            pulseGlow:    { '0%,100%': { boxShadow: '0 0 6px 1px currentColor' }, '50%': { boxShadow: '0 0 18px 6px currentColor' } },
            countdownPop: { '0%': { transform: 'scale(0.3)', opacity: '0' }, '60%': { transform: 'scale(1.15)', opacity: '1' }, '100%': { transform: 'scale(1)', opacity: '1' } },
            snakeSlither: { '0%,100%': { transform: 'translateX(0)' }, '25%': { transform: 'translateX(3px)' }, '75%': { transform: 'translateX(-3px)' } },
          },
        },
      },
    };
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.min.js"></script>

  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- App CSS -->
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body class="font-mono bg-bg text-fg antialiased select-none overflow-hidden h-screen w-screen flex flex-col">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!--  HEADER ‚Äî fixed top                                                    -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <header id="main-header" class="fixed top-0 left-0 right-0 z-50 h-12 flex items-center justify-between px-4 bg-bg/90 backdrop-blur border-b border-border transition-colors duration-300">
    <!-- Left: Logo + Name -->
    <div class="flex items-center gap-2">
      <span class="text-primary text-xl leading-none" aria-hidden="true">üêç</span>
      <h1 class="text-sm font-semibold tracking-tight text-fg">
        Snake <span class="text-primary">Arena</span>
      </h1>
    </div>

    <!-- Center: Nav (shown when in lobby/room) -->
    <nav id="header-nav" class="hidden md:flex items-center gap-4 text-xs text-muted-fg">
      <button id="nav-lobby" class="nav-link hidden items-center gap-1 transition-all duration-200 hover:text-primary" data-nav="lobby">
        <i data-lucide="layout-grid" class="w-3.5 h-3.5"></i>
        <span>Lobby</span>
      </button>
      <button id="nav-room" class="nav-link hidden items-center gap-1 transition-all duration-200 hover:text-primary" data-nav="room">
        <i data-lucide="door-open" class="w-3.5 h-3.5"></i>
        <span>Room</span>
      </button>
    </nav>

    <!-- Right: Connection status + Theme toggle -->
    <div class="flex items-center gap-3">
      <!-- Connection indicator -->
      <div id="conn-status" class="flex items-center gap-1.5 text-xs text-muted-fg" title="Disconnected">
        <span id="conn-dot" class="w-2 h-2 rounded-full bg-red-500 transition-colors duration-300"></span>
        <span id="conn-text" class="hidden sm:inline">Offline</span>
      </div>

      <!-- Theme toggle -->
      <button id="btn-theme" class="relative w-8 h-8 flex items-center justify-center text-fg transition-all duration-200 hover:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-ring" title="Toggle theme" aria-label="Toggle dark/light theme">
        <i data-lucide="moon" class="w-4 h-4 absolute transition-all duration-300 dark:opacity-100 dark:scale-100 opacity-0 scale-75"></i>
        <i data-lucide="sun" class="w-4 h-4 absolute transition-all duration-300 dark:opacity-0 dark:scale-75 opacity-100 scale-100"></i>
      </button>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!--  MAIN CONTENT AREA  (between header & footer)                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main id="main-content" class="flex-1 mt-12 mb-7 overflow-hidden relative">

    <!-- ‚îÄ‚îÄ‚îÄ SCREEN: WELCOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="screen-welcome" class="screen active absolute inset-0 flex items-center justify-center p-4 transition-all duration-300">
      <div class="w-full max-w-md space-y-6 animate-slide-up">
        <!-- Logo area -->
        <div class="text-center space-y-2">
          <div class="text-6xl leading-none animate-snake-slither inline-block">üêç</div>
          <h2 class="text-2xl font-bold tracking-tight text-fg">Snake <span class="text-primary">Arena</span></h2>
          <p class="text-xs text-muted-fg">Realtime Multiplayer Snake Battle</p>
        </div>

        <!-- Profile card -->
        <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-5 space-y-4 transition-colors duration-300">
          <!-- Username -->
          <div class="space-y-1.5">
            <label for="input-username" class="text-xs font-medium text-muted-fg flex items-center gap-1.5">
              <i data-lucide="user" class="w-3.5 h-3.5"></i>
              Username
            </label>
            <input id="input-username" type="text" maxlength="20" placeholder="Enter your name..." autocomplete="off" spellcheck="false"
              class="w-full h-9 px-3 text-sm bg-bg border border-input text-fg placeholder:text-muted-fg focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-200" />
          </div>

          <!-- Snake Color -->
          <div class="space-y-1.5">
            <label class="text-xs font-medium text-muted-fg flex items-center gap-1.5">
              <i data-lucide="palette" class="w-3.5 h-3.5"></i>
              Snake Color
            </label>
            <div id="color-picker" class="flex flex-wrap gap-2">
              <!-- Colors injected by JS from config -->
            </div>
          </div>

          <!-- Snake Pattern -->
          <div class="space-y-1.5">
            <label class="text-xs font-medium text-muted-fg flex items-center gap-1.5">
              <i data-lucide="layers" class="w-3.5 h-3.5"></i>
              Snake Pattern
            </label>
            <div id="pattern-picker" class="grid grid-cols-4 gap-2">
              <!-- Patterns injected by JS from config -->
            </div>
          </div>

          <!-- Snake Preview -->
          <div class="space-y-1.5">
            <label class="text-xs font-medium text-muted-fg flex items-center gap-1.5">
              <i data-lucide="eye" class="w-3.5 h-3.5"></i>
              Preview
            </label>
            <div class="bg-bg border border-input p-3 flex items-center justify-center h-16">
              <canvas id="snake-preview-canvas" width="200" height="40" class="w-full h-full" style="image-rendering: pixelated;"></canvas>
            </div>
          </div>
        </div>

        <!-- Connection status hint -->
        <div id="welcome-conn-status" class="flex items-center justify-center gap-2 text-xs">
          <span id="welcome-conn-dot" class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></span>
          <span id="welcome-conn-text" class="text-muted-fg">Connecting to server...</span>
        </div>

        <!-- Enter button -->
        <button id="btn-enter-arena" class="w-full h-10 px-8 text-sm font-semibold bg-primary text-primary-fg flex items-center justify-center gap-2 transition-all duration-200 hover:shadow-glow hover:brightness-110 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i data-lucide="swords" class="w-4 h-4 enter-icon"></i>
          <i data-lucide="loader-2" class="w-4 h-4 enter-spinner hidden animate-spin-slow"></i>
          <span id="enter-btn-label">Enter Arena</span>
        </button>

        <p id="welcome-error" class="text-xs text-center text-destructive hidden"></p>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ SCREEN: LOBBY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="screen-lobby" class="screen absolute inset-0 flex transition-all duration-300 opacity-0 pointer-events-none">

      <!-- Sidebar -->
      <aside id="lobby-sidebar" class="w-64 shrink-0 border-r border-border bg-card flex flex-col transition-all duration-300 overflow-hidden" data-open="true">
        <!-- Sidebar toggle -->
        <div class="h-10 flex items-center justify-between px-3 border-b border-border">
          <span class="text-xs font-semibold text-muted-fg uppercase tracking-wider">Rooms</span>
          <button id="btn-sidebar-toggle" class="w-7 h-7 flex items-center justify-center text-muted-fg transition-all duration-200 hover:text-primary focus:outline-none" title="Toggle sidebar">
            <i data-lucide="panel-left-close" class="w-4 h-4 sidebar-icon-open"></i>
            <i data-lucide="panel-left-open" class="w-4 h-4 sidebar-icon-closed hidden"></i>
          </button>
        </div>

        <!-- Create room button -->
        <div class="p-3 border-b border-border">
          <button id="btn-show-create-room" class="w-full h-8 px-3 text-xs font-medium bg-primary text-primary-fg flex items-center justify-center gap-1.5 transition-all duration-200 hover:shadow-glow hover:brightness-110 focus:outline-none">
            <i data-lucide="plus" class="w-3.5 h-3.5"></i>
            Create Room
          </button>
        </div>

        <!-- Join by Room Code -->
        <div class="p-3 border-b border-border space-y-1.5">
          <label class="text-[10px] font-medium text-muted-fg uppercase tracking-wider">Join by Code</label>
          <div class="flex gap-1.5">
            <input id="input-room-code" type="text" maxlength="6" placeholder="ROOM ID" autocomplete="off" spellcheck="false"
              class="flex-1 h-8 px-2 text-xs font-mono uppercase bg-bg border border-input text-fg placeholder:text-muted-fg focus:outline-none focus:ring-2 focus:ring-primary tracking-widest text-center transition-all duration-200" />
            <button id="btn-join-by-code" class="h-8 px-3 text-xs font-medium border border-input bg-bg text-fg flex items-center justify-center gap-1 transition-all duration-200 hover:border-primary hover:text-primary focus:outline-none" title="Join room by code">
              <i data-lucide="log-in" class="w-3.5 h-3.5"></i>
            </button>
          </div>
          <p id="join-code-error" class="text-[10px] text-destructive hidden"></p>
        </div>

        <!-- Room list -->
        <div id="room-list-container" class="flex-1 overflow-y-auto p-2 space-y-1.5 scrollbar-thin">
          <!-- Loading state -->
          <div id="room-list-loading" class="flex flex-col items-center justify-center py-8 text-muted-fg">
            <i data-lucide="loader-2" class="w-5 h-5 animate-spin-slow"></i>
            <span class="text-xs mt-2">Loading rooms...</span>
          </div>
          <!-- Empty state -->
          <div id="room-list-empty" class="hidden flex-col items-center justify-center py-8 text-muted-fg">
            <i data-lucide="inbox" class="w-8 h-8 opacity-40"></i>
            <span class="text-xs mt-2">No rooms yet</span>
            <span class="text-[10px] opacity-60">Create one to get started!</span>
          </div>
          <!-- Room entries injected here -->
          <div id="room-list" class="space-y-1.5"></div>
        </div>

        <!-- Online stats -->
        <div id="lobby-stats" class="p-3 border-t border-border text-[10px] text-muted-fg space-y-0.5">
          <div class="flex justify-between"><span>Rooms</span><span id="stat-rooms">0</span></div>
          <div class="flex justify-between"><span>Players Online</span><span id="stat-players">0</span></div>
          <div class="flex justify-between"><span>Playing Now</span><span id="stat-playing">0</span></div>
          <div class="flex justify-between"><span>All-Time Players</span><span id="stat-total-players">0</span></div>
          <div class="flex justify-between"><span>Total Games</span><span id="stat-total-games">0</span></div>
        </div>
      </aside>

      <!-- Main lobby area -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Lobby header -->
        <div class="h-10 flex items-center justify-between px-4 border-b border-border shrink-0">
          <div class="flex items-center gap-2 text-sm font-semibold text-fg">
            <button id="btn-sidebar-toggle-main" class="w-7 h-7 flex items-center justify-center text-muted-fg transition-all duration-200 hover:text-primary focus:outline-none mr-1" title="Toggle sidebar">
              <i data-lucide="panel-left-close" class="w-4 h-4 sidebar-icon-open-main"></i>
              <i data-lucide="panel-left-open" class="w-4 h-4 sidebar-icon-closed-main hidden"></i>
            </button>
            <i data-lucide="layout-grid" class="w-4 h-4 text-primary"></i>
            Lobby
          </div>
          <div id="lobby-player-tag" class="flex items-center gap-2 text-xs text-muted-fg">
            <span id="lobby-username" class="text-fg font-medium">Player</span>
            <span id="lobby-player-color" class="w-3 h-3 inline-block" style="background:#3A4DFF"></span>
          </div>
        </div>

        <!-- Lobby content tabs: Create Room / Global Leaderboard -->
        <div class="flex border-b border-border text-xs font-medium shrink-0">
          <button class="lobby-tab flex-1 py-2 text-center transition-colors duration-200 text-primary border-b-2 border-primary" data-tab="create">
            <i data-lucide="plus-circle" class="w-3.5 h-3.5 inline-block mr-1"></i>Create / Join
          </button>
          <button class="lobby-tab flex-1 py-2 text-center transition-colors duration-200 text-muted-fg border-b-2 border-transparent hover:text-fg" data-tab="leaderboard">
            <i data-lucide="trophy" class="w-3.5 h-3.5 inline-block mr-1"></i>All-Time Leaderboard
          </button>
          <button class="lobby-tab flex-1 py-2 text-center transition-colors duration-200 text-muted-fg border-b-2 border-transparent hover:text-fg" data-tab="my-stats">
            <i data-lucide="bar-chart-3" class="w-3.5 h-3.5 inline-block mr-1"></i>My Stats
          </button>
        </div>

        <!-- Lobby content area -->
        <div id="lobby-content" class="flex-1 flex items-center justify-center p-4 overflow-y-auto">

          <!-- Tab: Create Room (shown by default) -->
          <div id="create-room-panel" class="lobby-tab-panel w-full max-w-sm space-y-4 animate-fade-in" data-panel="create">
            <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-5 space-y-4 transition-colors duration-300">
              <h3 class="text-sm font-semibold flex items-center gap-2">
                <i data-lucide="plus-circle" class="w-4 h-4 text-primary"></i>
                Create New Room
              </h3>

              <!-- Room name -->
              <div class="space-y-1">
                <label for="input-room-name" class="text-xs text-muted-fg">Room Name</label>
                <input id="input-room-name" type="text" maxlength="24" placeholder="My Arena" autocomplete="off" spellcheck="false"
                  class="w-full h-9 px-3 text-sm bg-bg border border-input text-fg placeholder:text-muted-fg focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-200" />
              </div>

              <!-- Grid size -->
              <div class="space-y-1">
                <label class="text-xs text-muted-fg">Grid Size</label>
                <div id="grid-size-picker" class="grid grid-cols-3 gap-2">
                  <button class="grid-size-btn h-8 text-xs border border-input bg-bg text-fg flex items-center justify-center gap-1 transition-all duration-200 hover:border-primary focus:outline-none" data-size="small">
                    <i data-lucide="grid-2x2" class="w-3 h-3"></i> Small
                  </button>
                  <button class="grid-size-btn h-8 text-xs border border-input bg-bg text-fg flex items-center justify-center gap-1 transition-all duration-200 hover:border-primary focus:outline-none active" data-size="medium">
                    <i data-lucide="grid-3x3" class="w-3 h-3"></i> Medium
                  </button>
                  <button class="grid-size-btn h-8 text-xs border border-input bg-bg text-fg flex items-center justify-center gap-1 transition-all duration-200 hover:border-primary focus:outline-none" data-size="large">
                    <i data-lucide="maximize" class="w-3 h-3"></i> Large
                  </button>
                </div>
              </div>

              <!-- Max players -->
              <div class="space-y-1">
                <label for="input-max-players" class="text-xs text-muted-fg">Max Players</label>
                <div class="flex items-center gap-2">
                  <input id="input-max-players" type="range" min="2" max="50" value="10" class="flex-1 accent-primary" />
                  <span id="max-players-value" class="text-xs font-medium text-fg w-5 text-center">10</span>
                </div>
              </div>

              <!-- Game mode -->
              <div class="space-y-1">
                <label class="text-xs text-muted-fg">Game Mode</label>
                <div id="game-mode-picker" class="grid grid-cols-1 gap-1.5">
                  <button class="mode-btn h-auto py-2 px-3 text-xs border border-input bg-bg text-fg text-left flex items-start gap-2 transition-all duration-200 hover:border-primary focus:outline-none active" data-mode="last_standing">
                    <i data-lucide="trophy" class="w-3.5 h-3.5 mt-0.5 shrink-0 text-yellow-500"></i>
                    <div>
                      <div class="font-medium">Last Standing</div>
                      <div class="text-[10px] text-muted-fg">Last snake alive wins</div>
                    </div>
                  </button>
                  <button class="mode-btn h-auto py-2 px-3 text-xs border border-input bg-bg text-fg text-left flex items-start gap-2 transition-all duration-200 hover:border-primary focus:outline-none" data-mode="timed">
                    <i data-lucide="timer" class="w-3.5 h-3.5 mt-0.5 shrink-0 text-blue-400"></i>
                    <div>
                      <div id="timed-mode-label" class="font-medium">Timed (3 min)</div>
                      <div class="text-[10px] text-muted-fg">Highest score wins after time</div>
                    </div>
                  </button>
                  <button class="mode-btn h-auto py-2 px-3 text-xs border border-input bg-bg text-fg text-left flex items-start gap-2 transition-all duration-200 hover:border-primary focus:outline-none" data-mode="free_play">
                    <i data-lucide="infinity" class="w-3.5 h-3.5 mt-0.5 shrink-0 text-teal"></i>
                    <div>
                      <div class="font-medium">Free Play</div>
                      <div class="text-[10px] text-muted-fg">No end condition, just play</div>
                    </div>
                  </button>
                </div>
                <div id="timed-duration-row" class="flex items-center justify-between gap-2 pt-1 hidden">
                  <label for="input-timed-duration" class="text-xs text-muted-fg">Time Limit</label>
                  <select id="input-timed-duration" class="h-7 px-2 text-[10px] bg-bg border border-input text-fg focus:outline-none focus:ring-1 focus:ring-primary">
                    <option value="180">3 min</option>
                    <option value="300">5 min</option>
                    <option value="600">10 min</option>
                  </select>
                </div>
              </div>

              <!-- Create button -->
              <button id="btn-create-room" class="w-full h-9 px-4 text-sm font-semibold bg-primary text-primary-fg flex items-center justify-center gap-2 transition-all duration-200 hover:shadow-glow hover:brightness-110 focus:outline-none">
                <i data-lucide="plus" class="w-4 h-4"></i>
                Create & Join
              </button>
            </div>
          </div>

          <!-- Tab: Global Leaderboard -->
          <div id="global-lb-panel" class="lobby-tab-panel w-full max-w-lg space-y-4 hidden" data-panel="leaderboard">
            <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-5 space-y-4 transition-colors duration-300">
              <div class="flex items-center justify-between">
                <h3 id="global-lb-title" class="text-sm font-semibold flex items-center gap-2">
                  <i data-lucide="trophy" class="w-4 h-4 text-yellow-500"></i>
                  All-Time Leaderboard
                </h3>
                <div class="flex items-center gap-2">
                  <select id="global-lb-mode" class="h-7 px-2 text-[10px] bg-bg border border-input text-fg focus:outline-none focus:ring-1 focus:ring-primary">
                    <option value="last_standing">Last Standing</option>
                    <option value="timed">Timed</option>
                    <option value="free_play">Free Play</option>
                  </select>
                  <select id="global-lb-sort" class="h-7 px-2 text-[10px] bg-bg border border-input text-fg focus:outline-none focus:ring-1 focus:ring-primary">
                    <option value="totalScore">Total Score</option>
                    <option value="gamesWon">Games Won</option>
                    <option value="totalKills">Total Kills</option>
                    <option value="highestScore">Highest Score</option>
                    <option value="longestSnake">Longest Snake</option>
                    <option value="gamesPlayed">Games Played</option>
                  </select>
                </div>
              </div>

              <!-- Global summary bar -->
              <div id="global-lb-summary" class="grid grid-cols-4 gap-2 text-center text-[10px]">
                <div class="bg-bg p-1.5">
                  <div class="text-muted-fg">Players</div>
                  <div id="glb-total-players" class="font-semibold text-fg">0</div>
                </div>
                <div class="bg-bg p-1.5">
                  <div class="text-muted-fg">Games</div>
                  <div id="glb-total-games" class="font-semibold text-fg">0</div>
                </div>
                <div class="bg-bg p-1.5">
                  <div class="text-muted-fg">Kills</div>
                  <div id="glb-total-kills" class="font-semibold text-fg">0</div>
                </div>
                <div class="bg-bg p-1.5">
                  <div class="text-muted-fg">Score</div>
                  <div id="glb-total-score" class="font-semibold text-fg">0</div>
                </div>
              </div>

              <!-- Leaderboard list -->
              <div id="global-lb-list" class="space-y-1 max-h-72 overflow-y-auto scrollbar-thin">
                <div class="text-xs text-muted-fg text-center py-4">Loading leaderboard...</div>
              </div>
            </div>
          </div>

          <!-- Tab: My Stats -->
          <div id="my-stats-panel" class="lobby-tab-panel w-full max-w-lg space-y-4 hidden" data-panel="my-stats">
            <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-5 space-y-4 transition-colors duration-300">
              <h3 class="text-sm font-semibold flex items-center gap-2">
                <i data-lucide="bar-chart-3" class="w-4 h-4 text-primary"></i>
                My Stats
              </h3>

              <div id="my-stats-grid" class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Games</div>
                  <div id="ms-games-played" class="text-sm font-bold text-fg">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Wins</div>
                  <div id="ms-games-won" class="text-sm font-bold text-primary">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Win Rate</div>
                  <div id="ms-win-rate" class="text-sm font-bold text-teal">0%</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Total Kills</div>
                  <div id="ms-total-kills" class="text-sm font-bold text-destructive">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Highest Score</div>
                  <div id="ms-highest-score" class="text-sm font-bold text-yellow-500">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Longest Snake</div>
                  <div id="ms-longest-snake" class="text-sm font-bold text-teal">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Total Score</div>
                  <div id="ms-total-score" class="text-sm font-bold text-fg">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Deaths</div>
                  <div id="ms-total-deaths" class="text-sm font-bold text-muted-fg">0</div>
                </div>
                <div class="bg-bg p-2 space-y-0.5">
                  <div class="text-[10px] text-muted-fg">Best Rank</div>
                  <div id="ms-best-rank" class="text-sm font-bold text-yellow-500">‚Äî</div>
                </div>
              </div>

              <!-- Recent games -->
              <div class="space-y-1.5">
                <h4 class="text-xs font-semibold text-muted-fg flex items-center gap-1.5">
                  <i data-lucide="history" class="w-3.5 h-3.5"></i>
                  Recent Games
                </h4>
                <div id="my-recent-games" class="space-y-1 max-h-40 overflow-y-auto scrollbar-thin">
                  <div class="text-xs text-muted-fg text-center py-3">No games played yet</div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ SCREEN: ROOM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="screen-room" class="screen absolute inset-0 flex flex-col transition-all duration-300 opacity-0 pointer-events-none">
      <!-- Room header bar -->
      <div class="h-10 flex items-center justify-between px-4 border-b border-border shrink-0">
        <div class="flex items-center gap-2">
          <button id="btn-leave-room" class="h-7 px-2 text-xs text-muted-fg flex items-center gap-1 transition-all duration-200 hover:text-destructive focus:outline-none" title="Leave room">
            <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i>
            <span class="hidden sm:inline">Leave</span>
          </button>
          <div class="w-px h-5 bg-border"></div>
          <div class="flex items-center gap-1.5 text-sm font-semibold text-fg">
            <i data-lucide="door-open" class="w-4 h-4 text-primary"></i>
            <span id="room-name-display">Room</span>
          </div>
          <span id="room-id-badge" class="text-[10px] text-muted-fg bg-muted px-1.5 py-0.5 font-medium tracking-wider">CODE</span>
          <button id="btn-copy-room-id" class="w-6 h-6 flex items-center justify-center text-muted-fg hover:text-primary transition-colors duration-200" title="Copy Room ID" aria-label="Copy Room ID">
            <i data-lucide="copy" class="w-3.5 h-3.5"></i>
          </button>
        </div>
        <div class="flex items-center gap-2 text-xs text-muted-fg">
          <span id="room-mode-badge" class="text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 font-medium">MODE</span>
          <span id="room-grid-badge" class="text-[10px] bg-muted text-muted-fg px-1.5 py-0.5 font-medium">GRID</span>
        </div>
      </div>

      <!-- Room body -->
      <div class="flex-1 flex items-center justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-lg space-y-4 animate-fade-in">
          <!-- Players card -->
          <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-4 space-y-3 transition-colors duration-300">
            <div class="flex items-center justify-between">
              <h3 class="text-sm font-semibold flex items-center gap-2">
                <i data-lucide="users" class="w-4 h-4 text-primary"></i>
                Players
                <span id="room-player-count" class="text-[10px] bg-muted text-muted-fg px-1.5 py-0.5">0/6</span>
              </h3>
              <span id="room-state-badge" class="text-[10px] font-medium px-2 py-0.5 bg-yellow-500/10 text-yellow-500">WAITING</span>
            </div>

            <!-- Player list -->
            <div id="room-player-list" class="space-y-1.5 max-h-60 overflow-y-auto scrollbar-thin">
              <!-- Player entries injected by JS -->
            </div>
          </div>

          <!-- Room actions -->
          <div id="room-actions" class="space-y-2">
            <!-- Start Game (creator only) -->
            <button id="btn-start-game" class="w-full h-10 px-8 text-sm font-semibold bg-primary text-primary-fg items-center justify-center gap-2 transition-all duration-200 hover:shadow-glow hover:brightness-110 focus:outline-none hidden">
              <i data-lucide="play" class="w-4 h-4"></i>
              <span id="btn-start-game-label">Start Game</span>
            </button>

            <!-- Waiting for creator message -->
            <div id="room-waiting-msg" class="text-center text-xs text-muted-fg py-2 hidden">
              <i data-lucide="hourglass" class="w-4 h-4 inline-block animate-pulse mr-1"></i>
              Waiting for the room creator to start...
            </div>
          </div>

          <div id="room-chat" class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-4 transition-colors duration-300">
            <div class="flex items-center justify-between text-[10px] text-muted-fg uppercase tracking-wider">
              <span>Chat</span>
              <div class="flex items-center gap-2">
                <span id="room-chat-status" class="text-[9px] text-muted-fg/70">Room</span>
                <button id="btn-chat-toggle-room" class="text-[9px] text-muted-fg hover:text-primary transition-colors duration-200" type="button">Hide</button>
              </div>
            </div>
            <div id="room-chat-body" class="mt-2 space-y-2">
              <div id="room-chat-messages" class="h-28 overflow-y-auto space-y-1 text-[11px] leading-snug scrollbar-thin"></div>
              <form id="room-chat-form" class="flex gap-1">
                <input id="room-chat-input" type="text" maxlength="120" placeholder="Type message..." class="flex-1 h-7 px-2 text-[11px] bg-bg border border-input text-fg placeholder:text-muted-fg/70 focus:outline-none focus:ring-1 focus:ring-primary" autocomplete="off" />
                <button id="room-chat-send" type="submit" class="h-7 px-2 text-[11px] font-semibold bg-primary text-primary-fg hover:brightness-110 transition-all">Send</button>
              </form>
            </div>
          </div>

          <!-- Room info -->
          <div class="bg-card text-card-fg shadow-card dark:shadow-card-dark p-4 transition-colors duration-300">
            <h4 class="text-xs font-semibold text-muted-fg mb-2 flex items-center gap-1.5">
              <i data-lucide="info" class="w-3.5 h-3.5"></i>
              Room Info
            </h4>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
              <div class="flex justify-between text-muted-fg"><span>Mode</span><span id="room-info-mode" class="text-fg font-medium">‚Äî</span></div>
              <div class="flex justify-between text-muted-fg"><span>Grid</span><span id="room-info-grid" class="text-fg font-medium">‚Äî</span></div>
              <div class="flex justify-between text-muted-fg"><span>Creator</span><span id="room-info-creator" class="text-fg font-medium">‚Äî</span></div>
              <div class="flex justify-between text-muted-fg"><span>Round</span><span id="room-info-round" class="text-fg font-medium">#0</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ SCREEN: GAME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="screen-game" class="screen absolute inset-0 flex transition-all duration-300 opacity-0 pointer-events-none">

      <!-- Game canvas area -->
      <div id="game-canvas-container" class="flex-1 relative bg-black/5 dark:bg-black/30 overflow-hidden">
        <canvas id="game-canvas" class="absolute inset-0 w-full h-full"></canvas>

        <!-- Countdown overlay -->
        <div id="countdown-overlay" class="absolute inset-0 flex items-center justify-center bg-black/50 z-20 hidden">
          <div id="countdown-number" class="text-8xl font-bold text-primary animate-countdown-pop drop-shadow-lg">3</div>
        </div>

        <!-- Death overlay (shown when player dies, they can spectate or leave) -->
        <div id="death-overlay" class="absolute inset-0 flex items-center justify-center z-15 hidden pointer-events-none">
          <div class="text-center space-y-3 pointer-events-auto animate-slide-up bg-card/90 backdrop-blur p-6 shadow-card dark:shadow-card-dark max-w-xs">
            <div class="text-4xl">üíÄ</div>
            <div class="text-lg font-bold text-destructive">You Died!</div>
            <div id="death-cause" class="text-xs text-muted-fg">Hit a wall</div>
            <div id="death-score" class="text-sm font-semibold text-fg">Score: <span class="text-primary">0</span></div>
            <p class="text-[10px] text-muted-fg">You are now spectating</p>
            <div class="flex gap-2 mt-2">
              <button id="btn-death-spectate" class="flex-1 h-8 px-3 text-xs font-medium border border-input bg-bg text-fg flex items-center justify-center gap-1 transition-all duration-200 hover:border-primary focus:outline-none">
                <i data-lucide="eye" class="w-3 h-3"></i>
                Watch
              </button>
              <button id="btn-death-leave" class="flex-1 h-8 px-3 text-xs font-medium border border-destructive/50 bg-bg text-destructive flex items-center justify-center gap-1 transition-all duration-200 hover:bg-destructive/10 focus:outline-none">
                <i data-lucide="log-out" class="w-3 h-3"></i>
                Leave
              </button>
            </div>
          </div>
        </div>

        <!-- Game Over overlay -->
        <div id="gameover-overlay" class="absolute inset-0 flex items-center justify-center bg-black/60 z-30 hidden">
          <div class="w-full max-w-sm bg-card text-card-fg shadow-card dark:shadow-card-dark p-6 space-y-4 animate-slide-up">
            <div class="text-center space-y-1">
              <div class="text-4xl">üèÜ</div>
              <h2 class="text-xl font-bold text-fg">Game Over</h2>
              <div id="gameover-reason" class="text-xs text-muted-fg">Last standing</div>
            </div>

            <!-- Winner card -->
            <div id="gameover-winner" class="bg-bg p-3 text-center space-y-1 border border-primary/30 hidden">
              <div class="text-xs text-muted-fg uppercase tracking-wider">Winner</div>
              <div class="flex items-center justify-center gap-2">
                <span id="gameover-winner-color" class="w-3 h-3 inline-block"></span>
                <span id="gameover-winner-name" class="text-sm font-bold text-fg">‚Äî</span>
              </div>
              <div id="gameover-winner-score" class="text-xs text-primary font-semibold">Score: 0</div>
            </div>

            <!-- Standings table -->
            <div class="space-y-1">
              <h4 class="text-xs font-semibold text-muted-fg uppercase tracking-wider">Final Standings</h4>
              <div id="gameover-standings" class="max-h-40 overflow-y-auto space-y-1 scrollbar-thin">
                <!-- Injected by JS -->
              </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 gap-2 text-xs text-center">
              <div class="bg-bg p-2">
                <div class="text-muted-fg">Duration</div>
                <div id="gameover-duration" class="font-semibold text-fg">0:00</div>
              </div>
              <div class="bg-bg p-2">
                <div class="text-muted-fg">Round</div>
                <div id="gameover-round" class="font-semibold text-fg">#1</div>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2">
              <button id="btn-play-again" class="flex-1 h-9 px-4 text-sm font-semibold bg-primary text-primary-fg flex items-center justify-center gap-1.5 transition-all duration-200 hover:shadow-glow hover:brightness-110 focus:outline-none">
                <i data-lucide="rotate-ccw" class="w-3.5 h-3.5"></i>
                Play Again
              </button>
              <button id="btn-back-lobby" class="flex-1 h-9 px-4 text-sm font-medium border border-input bg-bg text-fg flex items-center justify-center gap-1.5 transition-all duration-200 hover:border-primary focus:outline-none">
                <i data-lucide="log-out" class="w-3.5 h-3.5"></i>
                Lobby
              </button>
            </div>
          </div>
        </div>

        <!-- HUD: top bar -->
        <div id="game-hud-top" class="absolute top-0 left-0 right-0 z-10 flex items-center justify-between px-3 py-1.5 bg-gradient-to-b from-black/40 to-transparent pointer-events-none">
          <div class="flex items-center gap-3 pointer-events-auto">
            <div class="flex items-center gap-1.5 text-white/90 text-xs">
              <i data-lucide="door-open" class="w-3 h-3"></i>
              <span id="hud-room-name" class="font-medium">Room</span>
            </div>
            <span id="hud-tick" class="text-[10px] text-white/40 font-mono">T:0</span>
          </div>
          <div class="flex items-center gap-4 pointer-events-auto">
            <div class="flex items-center gap-1.5 text-white/90 text-xs">
                <i data-lucide="target" class="w-3 h-3 text-primary"></i>
                <span>Score:</span>
                <span id="hud-score" class="font-bold text-primary">0</span>
              </div>
              <div class="flex items-center gap-1.5 text-white/90 text-xs">
                <i data-lucide="ruler" class="w-3 h-3 text-teal"></i>
                <span>Len:</span>
                <span id="hud-length" class="font-bold text-teal">10</span>
              </div>
              <div class="flex items-center gap-1.5 text-white/90 text-xs">
                <i data-lucide="skull" class="w-3 h-3 text-destructive"></i>
                <span>Kills:</span>
                <span id="hud-kills" class="font-bold text-destructive">0</span>
              </div>
          </div>
        </div>

        <!-- HUD: active powerups -->
        <div id="hud-powerups" class="absolute top-10 left-3 z-10 flex flex-col gap-1 pointer-events-none">
          <!-- Powerup badges injected by JS -->
        </div>

        <!-- Kill feed (left side) -->
        <div id="kill-feed" class="absolute top-10 right-3 z-10 flex flex-col gap-0.5 items-end pointer-events-none w-52">
          <!-- Kill feed entries injected by JS, auto-fade -->
        </div>

        <div id="game-chat" class="absolute bottom-3 left-3 z-10 w-64 md:w-72 pointer-events-auto">
          <div class="bg-card/80 backdrop-blur border border-border shadow-card dark:shadow-card-dark p-2 flex flex-col gap-2">
            <div class="flex items-center justify-between text-[10px] text-muted-fg uppercase tracking-wider">
              <span>Chat</span>
              <div class="flex items-center gap-2">
                <span id="game-chat-status" class="text-[9px] text-muted-fg/70">Room</span>
                <button id="btn-chat-toggle-game" class="text-[9px] text-muted-fg hover:text-primary transition-colors duration-200" type="button">Hide</button>
              </div>
            </div>
            <div id="game-chat-body" class="space-y-2">
              <div id="game-chat-messages" class="h-28 overflow-y-auto space-y-1 text-[11px] leading-snug scrollbar-thin"></div>
              <form id="game-chat-form" class="flex gap-1">
                <input id="game-chat-input" type="text" maxlength="120" placeholder="Type message..." class="flex-1 h-7 px-2 text-[11px] bg-bg border border-input text-fg placeholder:text-muted-fg/70 focus:outline-none focus:ring-1 focus:ring-primary" autocomplete="off" />
                <button id="game-chat-send" type="submit" class="h-7 px-2 text-[11px] font-semibold bg-primary text-primary-fg hover:brightness-110 transition-all">Send</button>
              </form>
            </div>
          </div>
        </div>

        <!-- Mobile touch controls -->
        <div id="mobile-controls" class="absolute bottom-4 left-1/2 -translate-x-1/2 z-10 pointer-events-auto md:hidden">
          <div class="flex items-center gap-3">
            <div class="grid grid-cols-3 gap-1 w-36">
              <div></div>
              <button class="touch-btn w-12 h-12 bg-white/10 backdrop-blur flex items-center justify-center text-white/80 active:bg-primary/40 transition-colors" data-dir="up">
                <i data-lucide="chevron-up" class="w-6 h-6"></i>
              </button>
              <div></div>
              <button class="touch-btn w-12 h-12 bg-white/10 backdrop-blur flex items-center justify-center text-white/80 active:bg-primary/40 transition-colors" data-dir="left">
                <i data-lucide="chevron-left" class="w-6 h-6"></i>
              </button>
              <div class="w-12 h-12"></div>
              <button class="touch-btn w-12 h-12 bg-white/10 backdrop-blur flex items-center justify-center text-white/80 active:bg-primary/40 transition-colors" data-dir="right">
                <i data-lucide="chevron-right" class="w-6 h-6"></i>
              </button>
              <div></div>
              <button class="touch-btn w-12 h-12 bg-white/10 backdrop-blur flex items-center justify-center text-white/80 active:bg-primary/40 transition-colors" data-dir="down">
                <i data-lucide="chevron-down" class="w-6 h-6"></i>
              </button>
              <div></div>
            </div>
            <!-- Boost button (mobile) -->
            <button id="btn-mobile-boost" class="w-16 h-16 bg-yellow-500/20 backdrop-blur border-2 border-yellow-500/40 flex items-center justify-center text-yellow-400 active:bg-yellow-500/40 transition-colors">
              <i data-lucide="zap" class="w-7 h-7"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Floating leaderboard toggle (visible when panel is closed) -->
      <button id="btn-lb-toggle-float" class="hidden absolute top-12 right-2 z-20 w-8 h-8 flex items-center justify-center bg-card/90 backdrop-blur border border-border text-muted-fg transition-all duration-200 hover:text-primary focus:outline-none" title="Show leaderboard">
        <i data-lucide="panel-right-open" class="w-4 h-4"></i>
      </button>

      <!-- Leaderboard sidebar (right, toggleable) -->
      <aside id="leaderboard-panel" class="w-60 shrink-0 border-l border-border bg-card flex flex-col transition-all duration-300 overflow-hidden" data-open="true">
        <!-- Toggle -->
        <div class="h-10 flex items-center justify-between px-3 border-b border-border">
          <span class="text-xs font-semibold text-muted-fg uppercase tracking-wider">Leaderboard</span>
          <button id="btn-lb-toggle" class="w-7 h-7 flex items-center justify-center text-muted-fg transition-all duration-200 hover:text-primary focus:outline-none" title="Toggle leaderboard">
            <i data-lucide="panel-right-close" class="w-4 h-4 lb-icon-open"></i>
            <i data-lucide="panel-right-open" class="w-4 h-4 lb-icon-closed hidden"></i>
          </button>
        </div>

        <!-- Leaderboard tabs -->
        <div class="flex border-b border-border text-[10px] font-medium">
          <button class="lb-tab flex-1 py-1.5 text-center transition-colors duration-200 text-primary border-b-2 border-primary" data-tab="alive">
            <i data-lucide="heart" class="w-3 h-3 inline-block mr-0.5"></i>Alive
          </button>
          <button class="lb-tab flex-1 py-1.5 text-center transition-colors duration-200 text-muted-fg border-b-2 border-transparent hover:text-fg" data-tab="longest">
            <i data-lucide="ruler" class="w-3 h-3 inline-block mr-0.5"></i>Longest
          </button>
          <button class="lb-tab flex-1 py-1.5 text-center transition-colors duration-200 text-muted-fg border-b-2 border-transparent hover:text-fg" data-tab="dead">
            <i data-lucide="skull" class="w-3 h-3 inline-block mr-0.5"></i>Dead
          </button>
        </div>

        <!-- Leaderboard content -->
        <div id="lb-content" class="flex-1 overflow-y-auto p-2 space-y-1 scrollbar-thin">
          <!-- Leaderboard entries injected by JS -->
          <div id="lb-empty" class="flex flex-col items-center justify-center py-6 text-muted-fg">
            <i data-lucide="bar-chart-3" class="w-6 h-6 opacity-40"></i>
            <span class="text-[10px] mt-1">No data yet</span>
          </div>
          <div id="lb-list" class="space-y-1"></div>
        </div>

        <!-- Game alive count -->
        <div class="p-2 border-t border-border text-center">
          <span class="text-[10px] text-muted-fg">Alive: <span id="lb-alive-count" class="text-fg font-semibold">0</span> / <span id="lb-total-count" class="text-fg">0</span></span>
        </div>
      </aside>
    </section>

  </main>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!--  FOOTER ‚Äî fixed bottom                                                 -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <footer id="main-footer" class="fixed bottom-0 left-0 right-0 z-50 h-7 flex items-center justify-between px-4 bg-bg/90 backdrop-blur border-t border-border text-[10px] text-muted-fg transition-colors duration-300">
    <span>Snake Arena v1.0 ‚Äî by <a class="text-primary font-medium" href="https://octwa.pw" target="_blank" rel="noopener noreferrer">OctWa</a></span>
    <span id="footer-ping" class="flex items-center gap-1">
      <i data-lucide="activity" class="w-3 h-3"></i>
      <span id="ping-value">‚Äî ms</span>
    </span>
  </footer>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!--  TOAST container                                                       -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="toast-container" class="fixed bottom-10 right-4 z-[100] flex flex-col gap-2 items-end pointer-events-none"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!--  Scripts (ES Modules)                                                  -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script src="/js/network.js"></script>
  <script src="/js/renderer.js"></script>
  <script src="/js/input.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/app.js"></script>

  <!-- Init Lucide icons -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) lucide.createIcons();
    });
  </script>

</body>
</html>
